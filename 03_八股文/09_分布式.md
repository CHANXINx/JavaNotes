## 1. CAP是什么？^
Consisten、Availability、Partial Tolerance。

- **一致性**：每次读取都会收到最新的写入数据或错误信息。
- **可用性**：每个请求都会收到（非错误的）响应，但不能保证响应包含最新的写入数据。
- **分区容忍性**：尽管网络节点之间会丢弃（或延迟）任意数量的消息，系统仍然能够继续运行。

- **CP**：用户下单，等待库存扣减操作结束后才返回结果。
	- CP是强一致性的，常用在金融、银行等对一致性要求高的场景。
- **AP**：用户下单，先返回响应结果，库存扣减操作异步处理。
	- AP是快速响应，提高用户体验，但无法保证最终库存扣减成功等，需要后续进行补救。
- AC：不再拆分数据系统，即不存在分布式的场景，回归单体系统。通过一个数据库完成库存校验扣减操作。
## 2. 什么是两阶段提交？

## 3. 什么是三阶段提交？为什么需要？
## 4. TCC是什么？和2PC有什么区别？

## 5. 什么是幂等性？^
同一个接口，多次发出同一个请求，请求的结果是一致的。

幂等性问题：

## 6. 如何解决接口幂等问题？
一锁、二判、三更新。

**一锁**：加互斥锁，如分布式锁、悲观锁。
**二判**：进行幂等性判断，如基于状态机、流水表、唯一性索引等进行重复操作的判断；
**三更新**：进行数据更新，持久化。

一锁非必须，在高并发的情况下才需要。

- **数据库唯一主键**：使用分布式ID充当主键，确保在全局下能保证只存在一条该记录，适用于“插入”操作的幂等性。 
- **唯一索引**：
- **状态机**：执行请求时，更新订单状态，更新成功会返回影响行数1，若更新失败则说明是重复请求，会返回影响行数0，此时直接返回即可，无需执行接下来的业务操作。
- **Token机制**：
## 7. 为什么不建议用数据库唯一性约束做幂等控制？


## 8. 什么是一致性哈希？
一致性哈希（Consistent Hashing）是一种用于分布式系统中数据分片和负载均衡的算法。它的目标是在节点的动态增加或删除时，尽可能地减少数据迁移和重新分布的成本。
## 9. 雪花算法是什么？
分布式ID生成算法，可以生成全局唯一且递增的ID。

核心思想：
将64位ID划分为多个部分，每个部分都有不同的含义，包括时间戳、数据中心标识、机器标识和序列号等。

1. 符号位(1bit)：始终为0，占用1位；
2. 时间戳(41bit)：精确到毫秒级别；
3. 数据中心标识(5bit)：用来区分不同的数据中心；
4. 机器标识(5bit)：区分不同的机器；
5. 序列号(12bit)：生成4096个不同的序列号。

如何保证全局唯一：
- 时间戳是高位，保证了ID的递增；
- 数据中心标识和机器标识是手工设置，保证不同的数据中心和机器生成的标识不同；
- 每次生成ID时序列号都会自增，解决了同一毫秒生成多次ID的问题。
![[Pasted image 20241208195828.png]]

## 10. 什么是负载均衡？有哪些常见算法？
