# 基础篇
## 1. 讲讲OSI七层模型。
1. 物理层（Physical Layer）：主要规定传输介质的传输方式，包括电信号、电压、光脉冲等。该层的主要协议是物理媒介相关协议，如RS232、V.35、以太网等。  
2. 数据链路层（Data Link Layer）：在物理层上建立数据链路，对数据进行分帧、差错校验等处理，确保数据可靠地传输。该层的主要协议有点对点协议PPP（Point-to-Point Protocol）、高级数据链路控制协议HDLC（High-Level Data Link Control）、以太网协议等。  
3. 网络层（Network Layer）：主要解决数据在网络中的传输问题，包括寻址、路由选择等。该层的主要协议有IP协议、网关协议（ARP）、路由协议（RIP、OSPF、BGP等）等。  
4. 传输层（Transport Layer）：提供端到端的可靠传输服务，包括数据传输控制、流量控制等。该层的主要协议有TCP协议、UDP协议、SCTP协议等。  
5. 会话层（Session Layer）：提供会话管理功能，负责建立、维护和结束会话。该层主要实现了不同计算机之间的会话控制，为高层协议提供一个传输数据的会话环境，该层的主要协议有NetBIOS等。  
6. 表示层（Presentation Layer）：负责数据格式的转换，确保应用层数据的格式一致。该层主要实现了数据格式的转换和数据加密解密等功能，如JPEG、MPEG等。  
7. 应用层（Application Layer）：提供应用程序之间的交互，包括文件传输、电子邮件、远程登录等。该层的主要协议有HTTP、FTP、SMTP、DNS、TELNET、SNMP等。
![[Pasted image 20241205223731.png|600]]

## 2. TCP/IP 五层模型和四层模型
四层：**应用层，传输层，网络层和网络接口层**（四层就是在五层的基础上将数据链路层和物理层合并成了网络接口层）
1. 应用层（Application Layer）：处理特定的应用程序，**如HTTP协议**、FTP协议等。
2. 传输层（Transport Layer）：建立端到端的连接，保证数据的完整性和可靠性，**如TCP协议**、**UDP协议等**。  
3. 网络层（Network Layer）：处理数据包的传输，确定网络地址，以及路由选择等，**如IP协议**、ICMP协议等。  
4. 数据链路层（Data Link Layer）：在物理层的基础上，定义了数据的格式、传输速率等，如以太网协议、Wi-Fi协议等。  
5. 物理层（Physical Layer）：定义物理设备标准，如网线、光纤、网卡等。  
![[Pasted image 20241208203017.png|400]]
## 3. TCP的粘包、拆包问题是什么？
#### 是什么？
TCP通信时，因为TCP是面向流的，所以发送方在传输数据时可能会**将多个小数据包粘合在一起进行发送**，而接收方可能**将这些数据包拆成多个小数据包进行接收**，从而导致数据接收错误、或者数据粘连问题。

主要出现在以下两种情况：
1. 发送方连续发送多个小数据包：TCP是基于流的协议，因此发送方可能将多个小数据包组合成一个大数据包进行发送，从而导致接收方在接收数据时**无法区分不同数据包的界限**。
2. 接收方缓存区大小限制：接收方在接收数据时，如果**接收缓存区大小有限，可能会将一个大数据包拆分成多个小数据包进行接收**，从而导致粘包和拆包问题出现。
#### 如何解决？
对包的格式进行约束，有以下四种常见的解决方案：
1. 将业务层协议包的**长度固定**，当客户端发送数据长度不足固定长度，则通过添加空格补全。
2. 在每个包的末尾**添加固定的分隔符**，如换行符\n，当拆分时，通过\n换行符连接不同包的拆分部分。
3. 仿照TCP/IP协议，将消息分为header和body，**在header中保存了当前整个消息的长度，只有读取到足够长度，才算一个完整消息**。
4. ~~通过自定义协议进行粘包和拆包处理。~~
## 4. ARP协议和RARP协议有什么区别？
二者都是网络通信协议，用于IP地址和MAC地址的转换。
#### 功能不同
ARP协议：用于将IP地址转换为MAC地址。
RARP协议：用于将MAC地址转换为IP地址。需要知道本机IP地址时，可以向网络中发送RARP请求，获取自己的IP地址。
#### 工作方式不同
ARP协议是**广播协议**，当一台主机需要知道另一台主句的MAC地址时，会在本地局域网上广播一个ARP请求包，所有主机都能接收该请求包，但只有目标主机会响应请求，发送自己的MAC地址。
RAPR协议，则是**向预定义的RARP服务器发出请求**，请求服务器返回本机IP地址。
## 5. 路由器和交换机的区别是什么？
在OSI七层模型中，路由器主要工作在网络层，交换机主要工作在数据链路层。

路由器转发依据IP地址，交换机转发依据的是MAC地址。
交换机用于组建局域网，路由器用于将局域网相互连接，或者接入互联网。

## 6. 什么是TCP三次握手、四次挥手？
### 三次握手（建立连接）
![[Pasted image 20241208203458.png]]
TCP是面向连接的，所以使用TCP之前必须先建立连接，而建立连接通过三次握手实现。具体过程如下：
 - **客户端发送 SYN**，请求建立连接。
- **服务端回复 SYN + ACK**，同意连接并同步状态。
- **客户端发送 ACK**，确认连接建立。

TCP的连接建立要解决以下三个问题：
1. 使TCP双方能够**确认对方的存在**；
2. 使TCP双方能够协商一些参数（如最大窗口值、是否使用窗口扩大选项和时间戳选项以及服务质量等）
3. 使TCP双方能够对运输实体资源（如缓存大小等）进行分配。

### 四次挥手（断开连接）
![[Pasted image 20250110215715.png]]
- **第一步（主动关闭方发送 FIN）：** 主动关闭方请求关闭连接。
- **第二步（被动关闭方发送 ACK）：** 被动关闭方确认请求，准备关闭。
- **第三步（被动关闭方发送 FIN）：** 被动关闭方请求关闭连接。
- **第四步（主动关闭方发送 ACK）：** 主动关闭方确认关闭，进入 `TIME_WAIT` 状态。
---
### 1. **TCP 三次握手（建立连接）**

**目标：** 确保通信双方都能正常发送和接收数据，建立可靠的连接。

**过程：**

1. **第一次握手（客户端 -> 服务端）：**  
    客户端发送一个带有 `SYN` 标志位的报文给服务端，表示请求建立连接，同时包含一个初始序列号 `seq = x`。  
    **作用：** 客户端发起连接请求。
2. **第二次握手（服务端 -> 客户端）：**  
    服务端收到客户端的 `SYN` 报文后，发送一个 `SYN+ACK` 报文给客户端，表示同意建立连接。
    - `SYN` 表示服务端愿意建立连接。
    - `ACK` 确认客户端的初始序列号，并返回 `ack = x+1`。  
        **作用：** 服务端确认收到连接请求，并向客户端发送自己的连接请求。
3. **第三次握手（客户端 -> 服务端）：**  
    客户端收到服务端的 `SYN+ACK` 报文后，发送一个 `ACK` 报文给服务端，确认服务端的序列号 `ack = y+1`。  
    **作用：** 客户端确认连接建立，双方进入 **ESTABLISHED** 状态。

**总结：** 三次握手的本质是为了确认：
- 双方的发送和接收能力正常。
- 双方的初始序列号已经交换，为后续可靠传输做好准备。

---

### 2. **TCP 四次挥手（断开连接）**

**目标：** 可靠地释放双方的资源，断开连接。

**过程：**
1. **第一次挥手（客户端 -> 服务端）：**  
    客户端发送一个 `FIN` 报文给服务端，表示数据发送完毕，请求断开连接。  
    **作用：** 客户端进入 **FIN_WAIT_1** 状态，等待服务端的确认。
2. **第二次挥手（服务端 -> 客户端）：**  
    服务端收到 `FIN` 报文后，返回一个 `ACK` 报文，表示收到断开请求。  
    **作用：** 服务端进入 **CLOSE_WAIT** 状态，客户端进入 **FIN_WAIT_2** 状态，等待服务端处理未完成的数据。
3. **第三次挥手（服务端 -> 客户端）：**  
    服务端处理完数据后，发送一个 `FIN` 报文，表示数据发送完毕，请求断开连接。  
    **作用：** 服务端进入 **LAST_ACK** 状态，等待客户端确认。
4. **第四次挥手（客户端 -> 服务端）：**  
    客户端收到服务端的 `FIN` 报文后，返回一个 `ACK` 报文，表示确认断开。
    - 客户端进入 **TIME_WAIT** 状态，等待一段时间（默认 2MSL，约 2 分钟）以保证服务端收到确认后完全关闭。
    - 服务端收到确认后进入 **CLOSED** 状态，释放连接资源。

**总结：** 四次挥手的设计目的是为了保证：
- 双方的数据都被完整传输，不会遗漏或丢失。
- 连接关闭后释放双方的资源。
## 7. 为什么需要三次握手？不能是两次吗？
简单来说，是为了防止超时失效的连接请求报文突然又传送到了TCP服务器，因而导致错误。

>**_The principle reason for the three-way handshake is to prevent old duplicate connection initiations from causing confusion.防止旧的重复连接初始化造成混乱。_**
## 8. 为什么需要四次挥手？
对于四次挥手，因为 TCP 是**全双工通信**，在主动关闭方发送 FIN 包后，**接收端可能还要发送数据，不能立即关闭服务器端到客户端的数据通道**，所以也就不能将服务器端的 FIN 包与对客户端的 ACK 包合并发送，只能先确认 ACK，然后服务器待无需发送数据时再发送 FIN 包，所以四次挥手时必须是四次数据包的交互。

服务器收到客户端的 FIN 报文时，内核会马上回一个 ACK 应答报文，**但是服务端应用程序可能还有数据要发送，所以并不能马上发送 FIN 报文，而是将发送 FIN 报文的控制权交给服务端应用程序**：
## 9. 第二次和第三次不能合并吗？
可以合并！当被动关闭方在 TCP 挥手过程中，「**没有数据要发送」并且「开启了 TCP 延迟确认机制」，那么第二和第三次挥手就会合并传输，这样就出现了三次挥手。**【**捎带确认机制**】
## 10. 为什么TCP客户进程在发送完最后一个确认 报文段后还要等待2MSL才关闭？
假设普通的TCP确认报文段发送后，TCP客户端进入关闭状态。此时**TCP确认报文段在发送过程中丢失，此时TCP服务器会对TCP连接释放报文段进行超时重传，并仍处于最后确认状态**。然而此时由于TCP客户端处于关闭状态，因此无法接收该报文，导致TCP服务器对该报文不断超时重传， 并始终处于最后确认状态，无法进入关闭状态。

总结：2MSL可以**保证TCP服务器能收到最后一个TCP确认报文段并进入关闭状态**

## 11. 若TCP客户端发生故障，TCP服务端是如何发现故障并及时关闭的？
使用保活计时器实现。
- TCP服务器每接收到TCP客户端发送的一条数据，就重新设置并启动保活计时器（2小时）
- 若保活计时器定时周期内未收到TCP客户端发送的数据，则**计时器到时后，TCP服务器进程就会向TCP客户端发送一个探测报文段**，以后每隔75秒发送一次。若**一连发送10个探测报文仍无TCP客户进程的响应**，TCP服务器进程就认为TCP客户进程所在主机发生了故障，就会关闭该连接。
## 12. 为什么SYN=1的报文不可以携带数据？
根据 TCP 协议规范（[RFC 793](https://tools.ietf.org/html/rfc793)），`SYN` 报文用于初始化连接，其序列号占用一个序号位置，但不携带实际数据。如果 `SYN` 报文携带数据，接收方需要在连接完全建立之前处理这些数据，这与 TCP 标准的连接控制逻辑相违背。
## 13. TCP保证可靠传输，如何理解这个可靠性？
网络协议可靠，需要满足以下要求：
1. 数据完整性。
2. 数据顺序。
3. 不能重复。
4. 不能被篡改。
## 14. TCP是如何保证可靠传输的？
TCP将应用数据分割成TCP认为最适合发送的数据块。TCP给发送的每个包进行编号，接收方对数据包进行排序，将有序数据传送到应用层。

- **连接管理**：即三次握手和四次挥手。连接管理机制能够建立起可靠的连接，这是保证传输可靠性的前提。
- **序列号**：TCP将每个字节的数据都进行了编号，这就是序列号。序列号的具体作用如下：能够保证可靠性，既能防止数据丢失，又能避免数据重复。能够保证有序性，按照序列号顺序进行数据包还原。能够提高效率，基于序列号可实现多次发送，一次确认。
- **确认应答**：接收方接收数据之后，会回传ACK报文，报文中带有此次确认的序列号，用于告知发送方此次接收数据的情况。在指定时间后，若发送端仍未收到确认应答，就会启动超时重传。
- **流量控制**：接收端处理数据的速度是有限的，如果发送方发送数据的速度过快，就会导致接收端的缓冲区溢出，进而导致丢包。为了避免上述情况的发生，TCP支持根据接收端的处理能力，来决定发送端的发送速度。这就是流量控制。流量控制是通过在TCP报文段首部维护一个滑动窗口来实现的。
- **拥塞控制**：拥塞控制就是当网络拥堵严重时，发送端减少数据发送。拥塞控制是通过发送端维护一个拥塞窗口来实现的。可以得出，发送端的发送速度，受限于滑动窗口和拥塞窗口中的最小值。拥塞控制方法分为：慢开始，拥塞避免、快重传和快恢复。
- **超时重传**：超时重传主要有两种场景：数据包丢失：在指定时间后，若发送端仍未收到确认应答，就会启动超时重传，向接收端重新发送数据包。确认包丢失：当接收端收到重复数据(通过序列号进行识别)时将其丢弃，并重新回传ACK报文。

## 15. TCP的拥塞控制方法有哪些？
#### 慢启动
#### 快重传
#### 快恢复
#### 拥塞避免
## 16. 什么是HTTP/3的QUIC协议？
HTTP/2弃用的原因，就是仍然使用TCP协议。因此，HTTP/3的引入必然是要绕开TCP的影响，因此有了基于UDP的QUIC协议。

QUIC协议的特点：
1. **基于UDP的传输层协议**。
2. 在UDP的基础上做了改造，实现了与TCP类似的可靠性（通过拥塞控制、数据包重传等手段）；
3. 实现了无序、并发的字节流。单个数据流传输是按序的，而多个数据流传输的乱序的；
4. 快速握手：提供0-RTT和1-RTT的连接建立；
5. 使用TLS 1.3 传输层安全协议。
## 17. HTTP和HTTPS的区别是什么？
HTTPS在HTTP的基础上，利用SSL/TLS加密数据包。

区别在以下几点：
1. 安全性：
	- HTTP使用明文传输。
	- HTTPS使用SSL或者TLS进行加密数据传输。
2. 默认端口不同：
	- HTTP默认端口为80；
	- HTTPS默认端口为443.
3. URL地址不同：
	- 前者为HTTP，后者为HTTPS.

SSL各个版本都存在安全漏洞，目前用的比较少
TLS 1.2和TLS 1.3是目前最广泛使用的版本，因为它们提供更高的安全性，引入了更有效的加密算法和协议优化。
## 18. 说说 TCP 和 UDP 的区别？
- **连接**：
	- TCP 是面向连接的传输层协议，传输数据前先要通过三次握手建立连接，并在结束后通过四次握手断开连接；
	- UDP 是不需要连接，即刻传输数据。
- **可靠性**：
	- TCP 是可靠交付数据的，通过确认和重传机制保证数据的正确送达。
	- UDP 是尽最大努力交付，发送数据单不保证可靠交付数据。但是我们可以基于 UDP 传输协议实现一个可靠的传输协议，比如 QUIC 协议
- **拥塞控制、流量控制**：
	- TCP 有拥塞控制和流量控制机制，保证数据传输的安全性。
	- UDP 则没有，即使网络非常拥堵了，也不会影响 UDP 的发送速率。
- **传输方式**：
	- TCP 是流式传输，没有边界，但保证顺序和可靠。
	- UDP 是报文传输，一个包一个包的发送，是有边界的，但可能会丢包和乱序。
- **首部开销**：
	- TCP 首部长度较长，最小为20字节，包含更多控制信息。
	- UDP 首部只有 8 个字节，并且是固定不变的，开销较小。
- **使用场景**：
	- TCP通常用于高可靠性的应用，如网页浏览、电子邮件、文件传输等；
	- UDP适用于实时应用，如视频流、语音通话等。
## 19. Cookie，Session，Token的区别是什么？
- cookie是存储于浏览器端的一小段文本数据，后续请求中，cookie会随着http请求一同发送到服务端。
- session是一种在服务端保存用户状态信息的机制，可以用于存储用户信息等资源，拥有一个唯一识别符号sessionId，通常存放于cookie中。服务器收到cookie后解析出sessionId，再去session列表中查找，才能找到相应session。
- token类似一个令牌，是一种用于身份验证的字符串，通常由服务器生成并发送到客户端。用户信息都被加密到token中，服务器收到token后解密就可知道是哪个用户。
## 20. ⭐浏览器输入`www.baidu.com`回车之后发生了什么？
- **解析URL**：分析 URL 所需要使用的传输协议和请求的资源路径。如果输入的 URL 中的协议或者主机名不合法，将会把地址栏中输入的内容传递给搜索引擎。如果没有问题，浏览器会检查 URL 中是否出现了非法字符，则对非法字符进行转义后在进行下一过程。
- **缓存判断**：浏览器会判断所请求的资源是否在缓存里，如果请求的资源在缓存里且没有失效，那么就直接使用，否则向服务器发起新的请求。
- **DNS解析**：如果资源不在本地缓存，首先需要进行DNS解析。浏览器会向本地DNS服务器发送域名解析请求，本地DNS服务器会逐级查询，最终找到对应的IP地址。
- **获取MAC地址**：当浏览器得到 IP 地址后，数据传输还需要知道目的主机 MAC 地址，因为应用层下发数据给传输层，TCP 协议会指定源端口号和目的端口号，然后下发给网络层。网络层会将本机地址作为源地址，获取的 IP 地址作为目的地址。然后将下发给数据链路层，数据链路层的发送需要加入通信双方的 MAC 地址，本机的 MAC 地址作为源 MAC 地址，目的 MAC 地址需要分情况处理。通过将 IP 地址与本机的子网掩码相结合，可以判断是否与请求主机在同一个子网里，如果在同一个子网里，可以使用 APR 协议获取到目的主机的 MAC 地址，如果不在一个子网里，那么请求应该转发给网关，由它代为转发，此时同样可以通过 ARP 协议来获取网关的 MAC 地址，此时目的主机的 MAC 地址应该为网关的地址。
- **建立TCP连接**：主机将使用目标 IP地址和目标MAC地址发送一个TCP SYN包，请求建立一个TCP连接，然后交给路由器转发，等路由器转到目标服务器后，服务器回复一个SYN-ACK包，确认连接请求。然后，主机发送一个ACK包，确认已收到服务器的确认，然后 TCP 连接建立完成。
- **HTTPS 的 TLS 四次握手**：如果使用的是 HTTPS 协议，在通信前还存在 TLS 的四次握手。
- **发送HTTP请求**：连接建立后，浏览器会向服务器发送HTTP请求。请求中包含了用户需要获取的资源的信息，例如网页的URL、请求方法（GET、POST等）等。
- **服务器处理请求并返回响应**：服务器收到请求后，会根据请求的内容进行相应的处理。例如，如果是请求网页，服务器会读取相应的网页文件，并生成HTTP响应。

**1. DNS 解析：** 将域名解析为 IP 地址。  
**2. TCP 三次握手：** 建立客户端与服务器的连接。  
**3. 浏览器发送 HTTP 请求：** 向服务器请求页面资源（如 HTML 文件）。  
**4. 服务器返回 HTTP 响应：** 包含 HTML、CSS、JS 等资源文件。  
**5. 浏览器渲染页面：** 解析 HTML 和 CSS，执行 JS，最终绘制页面。  
**6. 后续异步加载：** 如图片、AJAX 数据等。
## 21. 对称加密和非对称加密有什么区别？
#### 是什么AND区别
- 对称加密，指的是加密和解密使用**相同秘钥**的加密算法。对称加密可以通过加密后的密文，再根据密钥还原出明文。
- 非对称加密，指的是加密和解密使用不同密钥的加密算法，也称为公私钥加密。
#### 各举几个常见的加密算法
## 22. 简单介绍一下DNS
DNS全称Domain Name System，域名系统。 DNS是作为一个**将域名和IP地址相互映射的分布式数据库**，使得用户能更方便地访问互联网。

DNS最主要的作用就是将域名翻译成IP地址。因为为了方便记忆，都是将IP地址映射成由点分隔的字符组成的域名，用户可以通过直接访问域名来代替IP地址，DNS就是处理域名与IP地址相互映射的工具。

## 23. DNS的解析过程是怎样的？
先查询本地缓存和HOST绑定，再向本地DNS服务器发送查询请求，最后向根服务器发送请求。
![[Pasted image 20250409002304.png]]
#### DNS污染
刻意制造或无意中制造的域名服务器数据包，将域名指向不正确的IP地址。
#### DNS劫持

#### DNS劫持与DNS污染的区别？
## 24. Ping的原理是什么？
ping用于探测本机与网络中的另一台主机是否可达。利用Ping命令可以检查网络是否畅通以及网络连接速度。

Ping是基于**ICMP协议**（Internet Control Messages Protocol）来工作的，即**因特网信报控制协议**）。Ping利用了ICMP的两种控制消息：echo request回显请求和echo reply回显应答。主机A执行Ping时，就会发送回显请求，主机B正确接收后会返回回显应答，通过对方回复的数据包来确定两台网络机器是否相同、以及时延是多少。

PING命令本身处于应用层，而ICMP是网络层协议，因此PING命令是一个**应用层直接使用网络层**的例子。
## 25. 如何解决跨域问题？
跨域访问问题（Cross-Origin Resource Sharing，CORS）是由浏览器同源策略引发的，它要求网页中的所有资源必须来自同一个域名、协议和端口，否则浏览器会阻止跨域的资源请求。

#### 解决办法
1. **CORS**：CORS是目前最常见的解决跨域问题的方案，通过在服务端设置相应的响应头来解决跨域问题。服务器在响应中添加Access-Control-Allow-Origin头，指定允许跨域访问的域名或通配符*，使得浏览器可以放行跨域请求。
2. 
3. **代理服务器**：在同源域名下设置代理服务器实现跨域访问。前端将请求发送给代理服务器，通过代理服务器转发给目标服务器，并将响应返回给前端。
## 26. CDN是什么，为什么可以做缓存？
CDN是Content Delivery Network的缩写，翻译成**内容分发网络**。主要通过**将内容存储在全国各地的边缘节点**，以就近原则向用户提供内容。

CDN可以做缓存是因为它在全球范围内部署了多个边缘节点，这些节点分布在不同的地理位置，靠近用户所在的区域。当用户请求某个资源（例如网页、图片、视频等），CDN会根据用户的位置，**将资源从最近的边缘节点提供给用户**。

用户首次访问这些资源的时候，**CDN会将资源从服务器获取到，并将其缓存到边缘节点上**。当其他用户在同一地区请求相同的资源时，CDN会直接从边缘节点返回缓存的副本，而不必再次访问源服务器。这样可以减少网络延迟和带宽消耗，提高内容的传输速度和响应性能。
## 27. 什么是长连接和短连接？
#### 短连接
- 客户端和服务器之间的连接在每次请求完毕后立即关闭，下一次请求重新建立连接。
- 优点：
	- 节约服务器资源，也能避免服务器长时间维护过多连接。
- 缺点：
	- 每次请求都需要重新建立连接，有很多额外的性能开销。
#### 长连接
- 客户端与服务端建立TCP连接后，保持连接状态，允许复用一个连接进行多次请求和响应。
- 优点：
	- 避免频繁建立和关闭TCP连接的开销，提高性能。
- 缺点：
	- 服务器需要维护大量连接，导致资源占用增加；
	- 连接可能因超时而断开，需要心跳检测（KeepAlive机制）来维持连接。

---

